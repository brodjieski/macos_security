id: os_policy_banner_ssh_enforce
title: Enforce SSH to Display Policy Banner
discussion: "SSH _MUST_ be configured to display a policy banner. \n\nDisplaying a standardized and approved use notification before granting access to the operating system ensures that users are provided with privacy and security notification verbiage that is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.\n\nSystem use notifications are required only for access via login interfaces with human users and are not required when such human interfaces do not exist\n\nNOTE: /etc/ssh/sshd_config will be automatically modified to its original state following any update or major upgrade to the operating system.\n"
check: $OS_VALUE
result:
  integer: 1
fix: $OS_VALUE
references:
  cce:
    - $OS_VALUE
  cci:
    - CCI-000048
    - CCI-000050
  800-53r5:
    - AC-8
  800-53r4:
    - AC-8
  srg:
    - $OS_VALUE
  disa_stig:
    - $OS_VALUE
  800-171r2:
    - 3.1.9
tags:
  - stig
severity: medium
mobileconfig: false
mobileconfig_info: null
os_specifics:
  macOS:
    '11.0':
      references:
        cce:
          - CCE-85357-2
        disa_stig:
          - APPL-11-000024
        srg:
          - SRG-OS-000023-GPOS-00006
      check: "/usr/bin/grep -c \"^Banner /etc/banner\" /etc/ssh/sshd_config \n"
      fix: |
        [source,bash]
        ----
        /usr/bin/sed -i.bak 's/^[\#]*Banner.*/Banner \/etc\/banner/' /etc/ssh/sshd_config
        ----
    '12.0':
      references:
        cce:
          - CCE-90975-4
        disa_stig:
          - APPL-12-000024
        srg:
          - SRG-OS-000023-GPOS-00006
          - SRG-OS-000024-GPOS-00007
      check: |
        /usr/sbin/sshd -T | /usr/bin/grep -c "^banner /etc/banner"
      fix: |
        [source,bash]
        ----
        include_dir=$(/usr/bin/awk '/^Include/ {print $2}' /etc/ssh/sshd_config | /usr/bin/tr -d '*')

        if [[ -z $include_dir ]]; then
          /usr/bin/sed -i.bk "1s/.*/Include \/etc\/ssh\/sshd_config.d\/\*/" /etc/ssh/sshd_config
        fi

        echo "banner /etc/banner" >> "${include_dir}01-mscp-sshd.conf"

        for file in $(ls ${include_dir}); do
          if [[ "$file" == "100-macos.conf" ]]; then
              continue
          fi
          if [[ "$file" == "01-mscp-sshd.conf" ]]; then
              break
          fi
          /bin/mv ${include_dir}${file} ${include_dir}20-${file}
        done
    '13.0':
      references:
        cce:
          - CCE-91847-4
        disa_stig:
          - N/A
        srg:
          - N/A
      check: |
        /usr/sbin/sshd -T | /usr/bin/grep -c "^banner /etc/banner"
      fix: |
        [source,bash]
        ----
        include_dir=$(/usr/bin/awk '/^Include/ {print $2}' /etc/ssh/sshd_config | /usr/bin/tr -d '*')

        if [[ -z $include_dir ]]; then
          /usr/bin/sed -i.bk "1s/.*/Include \/etc\/ssh\/sshd_config.d\/\*/" /etc/ssh/sshd_config
        fi

        echo "banner /etc/banner" >> "${include_dir}01-mscp-sshd.conf"

        for file in $(ls ${include_dir}); do
          if [[ "$file" == "100-macos.conf" ]]; then
              continue
          fi
          if [[ "$file" == "01-mscp-sshd.conf" ]]; then
              break
          fi
          /bin/mv ${include_dir}${file} ${include_dir}20-${file}
        done
